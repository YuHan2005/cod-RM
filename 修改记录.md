# 开发日志

## 2025-09-24

**变更**
- 引入「同济版」扩展卡尔曼滤波（EKF）代码。
- 更换协方差更新为 **Joseph 形式**：`P = (I - K H) P (I - K H)^T + K R K^T`。
- 新增/调整卡方检验（NIS/NEES）统计字段与滑动窗口统计。

**备注（有待考证）**
> **有待考证**：GPT 评审指出当前卡方检验的实现不符合标准 EKF 门控（NIS 应使用先验状态与先验协方差，在**更新前**完成门控）。需对照后续代码与调用流程进一步核实。

**待核实清单**
- [ ] NIS 是否基于先验计算：`y = z - h(x_prior)`，`S = H P_prior H^T + R`，并在状态更新**前**做门控。
- [ ] 是否避免显式求逆：用 `LDLT/LLT` 的 `solve` 替代 `S.inverse()`。
- [ ] 量测残差字段访问是否越界（`residual[0..3]` 在量测维度 < 4 时会越界）。
- [ ] 每次更新开始是否重置 `nis_fail / nees_fail` 标志位。
- [ ] `P` 数值对称性修正：`P = 0.5 * (P + P^T)`（必要时）。

**相关文件**
- `New_Extended_Kalman_Filter.hpp`
- `New_Extended_Kalman_Filter.cpp`

---
